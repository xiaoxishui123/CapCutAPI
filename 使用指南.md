# CapCutAPI å®Œæ•´ä½¿ç”¨æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

CapCutAPIæ˜¯ä¸€ä¸ªåŸºäºPython Flaskçš„å‰ªæ˜ /CapCutè‡ªåŠ¨åŒ–APIæœåŠ¡ï¼Œå¯ä»¥é€šè¿‡HTTP APIæ¥å£å®ç°è§†é¢‘ç¼–è¾‘çš„è‡ªåŠ¨åŒ–æ“ä½œã€‚

### ğŸŒ å½“å‰éƒ¨ç½²çŠ¶æ€
- **âœ… æœåŠ¡çŠ¶æ€**: æ­£åœ¨è¿è¡Œ
- **ğŸŒ è®¿é—®åœ°å€**: http://8.148.70.18:9000
- **ğŸ Pythonç‰ˆæœ¬**: 3.9.7
- **ğŸ“ éƒ¨ç½²ä½ç½®**: /home/CapCutAPI

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ç½‘é¡µç•Œé¢æµ‹è¯•ï¼ˆæ¨èæ–°æ‰‹ï¼‰
**ç«‹å³ä½“éªŒ:** http://8.148.70.18:9000/comprehensive-test

1. æ‰“å¼€æµ‹è¯•é¡µé¢
2. ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"æŒ‰é’®
3. è§‚å¯Ÿæµ‹è¯•ç»“æœå’ŒAPIå“åº”
4. æ ¹æ®ç»“æœäº†è§£APIåŠŸèƒ½

### æ–¹æ³•2: å‘½ä»¤è¡Œæµ‹è¯•
```bash
# æµ‹è¯•1: è·å–APIä¿¡æ¯
curl http://8.148.70.18:9000/

# æµ‹è¯•2: åˆ›å»ºè‰ç¨¿
curl -X POST http://8.148.70.18:9000/create_draft \
  -H "Content-Type: application/json" \
  -d '{"draft_name":"æˆ‘çš„ç¬¬ä¸€ä¸ªè‰ç¨¿"}'
```

### æ–¹æ³•3: Pythonè„šæœ¬
è¿è¡Œé¡¹ç›®æä¾›çš„æµ‹è¯•è„šæœ¬ï¼š
```bash
cd /home/CapCutAPI
python3.9 test_api.py
```

## ğŸ¬ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. ğŸ“ åˆ›å»ºè§†é¢‘è‰ç¨¿
```bash
# åŸºç¡€åˆ›å»º
curl -X POST http://8.148.70.18:9000/create_draft \
  -H "Content-Type: application/json" \
  -d '{
    "draft_name": "æˆ‘çš„è§†é¢‘é¡¹ç›®",
    "width": 1080,
    "height": 1920
  }'
```

**æ”¯æŒçš„è§†é¢‘å°ºå¯¸:**
- ç«–å±: 1080x1920 (æŠ–éŸ³ã€å¿«æ‰‹)
- æ¨ªå±: 1920x1080 (YouTubeã€Bç«™)
- æ–¹å½¢: 1080x1080 (Instagram)

### 2. âœï¸ æ·»åŠ æ–‡æœ¬å†…å®¹
```bash
curl -X POST http://8.148.70.18:9000/add_text \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "text": "æ¬¢è¿å…³æ³¨æˆ‘çš„é¢‘é“ï¼",
    "start": 0,
    "end": 3,
    "font": "HarmonyOS_Sans_SC_Bold",
    "font_color": "#FF0000",
    "font_size": 36.0,
    "track_name": "title_text"
  }'
```

### 3. ğŸ–¼ï¸ æ·»åŠ å›¾ç‰‡ç´ æ
```bash
curl -X POST http://8.148.70.18:9000/add_image \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "image_url": "https://example.com/image.jpg",
    "start": 0,
    "end": 5,
    "track_name": "background_image"
  }'
```

### 4. ğŸµ æ·»åŠ èƒŒæ™¯éŸ³ä¹
```bash
curl -X POST http://8.148.70.18:9000/add_audio \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "audio_url": "https://example.com/music.mp3",
    "start": 0,
    "end": 30,
    "target_start": 0,
    "volume": 0.8,
    "track_name": "background_music"
  }'
```

### 5. ğŸ¥ æ·»åŠ è§†é¢‘ç‰‡æ®µ
```bash
curl -X POST http://8.148.70.18:9000/add_video \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "video_url": "https://example.com/video.mp4",
    "start": 0,
    "end": 10,
    "width": 1080,
    "height": 1920,
    "track_name": "main_video"
  }'
```

### 6. ğŸ’¾ ä¿å­˜è‰ç¨¿
```bash
curl -X POST http://8.148.70.18:9000/save_draft \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "draft_folder": "/tmp/my_capcut_project"
  }'
```

## ğŸ“± å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1: è‡ªåŠ¨åŒ–çŸ­è§†é¢‘åˆ¶ä½œ
```python
import requests
import json

BASE_URL = "http://8.148.70.18:9000"

def create_short_video():
    # 1. åˆ›å»ºç«–å±è‰ç¨¿
    draft_response = requests.post(f"{BASE_URL}/create_draft", json={
        "draft_name": "æ¯æ—¥çŸ­è§†é¢‘",
        "width": 1080,
        "height": 1920
    })
    draft_id = draft_response.json()["output"]["draft_id"]
    
    # 2. æ·»åŠ æ ‡é¢˜æ–‡å­—
    requests.post(f"{BASE_URL}/add_text", json={
        "draft_id": draft_id,
        "text": "ä»Šæ—¥çƒ­ç‚¹æ–°é—»",
        "start": 0,
        "end": 2,
        "font": "HarmonyOS_Sans_SC_Bold",
        "font_color": "#FFFFFF",
        "font_size": 42.0
    })
    
    # 3. æ·»åŠ èƒŒæ™¯å›¾ç‰‡
    requests.post(f"{BASE_URL}/add_image", json={
        "draft_id": draft_id,
        "image_url": "https://picsum.photos/1080/1920",
        "start": 0,
        "end": 15
    })
    
    # 4. æ·»åŠ å†…å®¹æ–‡å­—
    requests.post(f"{BASE_URL}/add_text", json={
        "draft_id": draft_id,
        "text": "è¿™é‡Œæ˜¯æ–°é—»å†…å®¹...",
        "start": 2,
        "end": 12,
        "font": "HarmonyOS_Sans_SC_Regular",
        "font_color": "#000000",
        "font_size": 28.0
    })
    
    # 5. ä¿å­˜è‰ç¨¿
    requests.post(f"{BASE_URL}/save_draft", json={
        "draft_id": draft_id,
        "draft_folder": "/tmp/daily_shorts"
    })
    
    return draft_id

# æ‰§è¡Œå‡½æ•°
video_id = create_short_video()
print(f"çŸ­è§†é¢‘è‰ç¨¿åˆ›å»ºå®Œæˆ: {video_id}")
```

### åœºæ™¯2: æ‰¹é‡å¤„ç†å¤šä¸ªè§†é¢‘
```python
def batch_create_videos(video_data_list):
    """æ‰¹é‡åˆ›å»ºå¤šä¸ªè§†é¢‘è‰ç¨¿"""
    results = []
    
    for video_data in video_data_list:
        # åˆ›å»ºè‰ç¨¿
        draft_response = requests.post(f"{BASE_URL}/create_draft", json={
            "draft_name": video_data["title"],
            "width": 1920,
            "height": 1080
        })
        draft_id = draft_response.json()["output"]["draft_id"]
        
        # æ·»åŠ è§†é¢‘å†…å®¹
        requests.post(f"{BASE_URL}/add_video", json={
            "draft_id": draft_id,
            "video_url": video_data["video_url"],
            "start": 0,
            "end": video_data["duration"]
        })
        
        # æ·»åŠ å­—å¹•
        requests.post(f"{BASE_URL}/add_text", json={
            "draft_id": draft_id,
            "text": video_data["subtitle"],
            "start": 0,
            "end": video_data["duration"],
            "font": "HarmonyOS_Sans_SC_Regular",
            "font_size": 24.0
        })
        
        results.append(draft_id)
    
    return results

# ç¤ºä¾‹æ•°æ®
videos = [
    {"title": "è§†é¢‘1", "video_url": "http://example.com/v1.mp4", "duration": 30, "subtitle": "ç¬¬ä¸€æ®µå†…å®¹"},
    {"title": "è§†é¢‘2", "video_url": "http://example.com/v2.mp4", "duration": 45, "subtitle": "ç¬¬äºŒæ®µå†…å®¹"},
]

batch_results = batch_create_videos(videos)
```

### åœºæ™¯3: åŠ¨æ€å†…å®¹ç”Ÿæˆ
```python
def create_dynamic_content(news_data):
    """æ ¹æ®æ–°é—»æ•°æ®åŠ¨æ€ç”Ÿæˆè§†é¢‘"""
    
    # åˆ›å»ºè‰ç¨¿
    draft_response = requests.post(f"{BASE_URL}/create_draft", json={
        "draft_name": f"æ–°é—»_{news_data['date']}",
        "width": 1080,
        "height": 1920
    })
    draft_id = draft_response.json()["output"]["draft_id"]
    
    # åŠ¨æ€æ·»åŠ æ–°é—»æ ‡é¢˜
    requests.post(f"{BASE_URL}/add_text", json={
        "draft_id": draft_id,
        "text": news_data["headline"],
        "start": 0,
        "end": 3,
        "font": "HarmonyOS_Sans_SC_Bold",
        "font_color": "#FF4444",
        "font_size": 38.0
    })
    
    # åˆ†æ®µæ·»åŠ æ–°é—»å†…å®¹
    content_parts = news_data["content"].split("ã€‚")
    for i, part in enumerate(content_parts[:5]):  # æœ€å¤š5æ®µ
        if part.strip():
            requests.post(f"{BASE_URL}/add_text", json={
                "draft_id": draft_id,
                "text": part.strip() + "ã€‚",
                "start": 3 + i * 2,
                "end": 5 + i * 2,
                "font": "HarmonyOS_Sans_SC_Regular",
                "font_size": 26.0
            })
    
    return draft_id
```

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½

### è·å–å¯ç”¨èµ„æº
```bash
# è·å–æ‰€æœ‰å¯ç”¨å­—ä½“
curl http://8.148.70.18:9000/get_font_types

# è·å–è½¬åœºæ•ˆæœç±»å‹
curl http://8.148.70.18:9000/get_transition_types

# è·å–è’™ç‰ˆç±»å‹
curl http://8.148.70.18:9000/get_mask_types
```

### æ·»åŠ ç‰¹æ•ˆå’ŒåŠ¨ç”»
```bash
# æ·»åŠ æ–‡æœ¬å…¥åœºåŠ¨ç”»
curl -X POST http://8.148.70.18:9000/add_effect \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "track_name": "your_text_track",
    "effect_type": "intro_animation",
    "effect_name": "fade_in"
  }'
```

### æ·»åŠ è´´çº¸å’Œè£…é¥°
```bash
curl -X POST http://8.148.70.18:9000/add_sticker \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "sticker_url": "https://example.com/sticker.png",
    "start": 0,
    "end": 5,
    "x": 100,
    "y": 100
  }'
```

## ğŸ“Š ç›‘æ§å’Œç®¡ç†

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹APIæœåŠ¡çŠ¶æ€
curl http://8.148.70.18:9000/

# æ£€æŸ¥æœåŠ¡å™¨è¿›ç¨‹
ps aux | grep capcut_server

# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
tail -f /home/CapCutAPI/capcut_server.log
```

### é‡å¯æœåŠ¡
```bash
cd /home/CapCutAPI

# åœæ­¢æœåŠ¡
pkill -f "python3.9 capcut_server.py"

# é‡æ–°å¯åŠ¨
nohup python3.9 capcut_server.py > capcut_server.log 2>&1 &
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†
```python
def safe_api_call(endpoint, data):
    try:
        response = requests.post(f"{BASE_URL}/{endpoint}", json=data, timeout=30)
        response.raise_for_status()
        return response.json()
    except requests.exceptions.RequestException as e:
        print(f"APIè°ƒç”¨å¤±è´¥: {e}")
        return None
```

### 2. è‰ç¨¿IDç®¡ç†
```python
class CapCutProject:
    def __init__(self, name):
        self.name = name
        self.draft_id = None
        
    def create_draft(self, width=1080, height=1920):
        response = requests.post(f"{BASE_URL}/create_draft", json={
            "draft_name": self.name,
            "width": width,
            "height": height
        })
        self.draft_id = response.json()["output"]["draft_id"]
        return self.draft_id
    
    def add_text(self, text, start, end, **kwargs):
        if not self.draft_id:
            raise ValueError("è¯·å…ˆåˆ›å»ºè‰ç¨¿")
        
        data = {
            "draft_id": self.draft_id,
            "text": text,
            "start": start,
            "end": end,
            **kwargs
        }
        return requests.post(f"{BASE_URL}/add_text", json=data)
```

### 3. æ—¶é—´è½´ç®¡ç†
```python
class Timeline:
    def __init__(self):
        self.events = []
    
    def add_event(self, event_type, start, end, data):
        self.events.append({
            "type": event_type,
            "start": start,
            "end": end,
            "data": data
        })
    
    def get_duration(self):
        if not self.events:
            return 0
        return max(event["end"] for event in self.events)
    
    def execute(self, draft_id):
        for event in self.events:
            if event["type"] == "text":
                requests.post(f"{BASE_URL}/add_text", json={
                    "draft_id": draft_id,
                    **event["data"],
                    "start": event["start"],
                    "end": event["end"]
                })
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: APIè¿”å›404é”™è¯¯ï¼Ÿ**
A: æ£€æŸ¥ç«¯ç‚¹è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿ä½¿ç”¨POSTæ–¹æ³•è®¿é—®éœ€è¦POSTçš„ç«¯ç‚¹

**Q: å­—ä½“ä¸æ”¯æŒé”™è¯¯ï¼Ÿ**
A: ä½¿ç”¨ `curl http://8.148.70.18:9000/get_font_types` æŸ¥çœ‹æ”¯æŒçš„å­—ä½“åˆ—è¡¨

**Q: è‰ç¨¿ä¿å­˜å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥ä¿å­˜è·¯å¾„æƒé™ï¼Œå»ºè®®ä½¿ç”¨ `/tmp/` ç›®å½•

**Q: æœåŠ¡å™¨æ— å“åº”ï¼Ÿ**
A: æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€ï¼š`ps aux | grep capcut_server`

### è°ƒè¯•æŠ€å·§
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
tail -f /home/CapCutAPI/capcut_server.log

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
curl -I http://8.148.70.18:9000/

# éªŒè¯JSONæ ¼å¼
echo '{"test": "data"}' | python3.9 -m json.tool
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **ç†Ÿæ‚‰åŸºç¡€åŠŸèƒ½**: ä½¿ç”¨ç½‘é¡µæµ‹è¯•ç•Œé¢äº†è§£APIåŠŸèƒ½
2. **ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬**: æ ¹æ®æ‚¨çš„éœ€æ±‚ç¼–å†™Pythonè„šæœ¬
3. **é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ**: å°†APIé›†æˆåˆ°æ‚¨çš„å·¥ä½œæµç¨‹ä¸­
4. **æ‰©å±•åŠŸèƒ½**: æ ¹æ®éœ€è¦æ·»åŠ æ–°çš„APIç«¯ç‚¹

## ğŸ“ è·å–å¸®åŠ©

- **æµ‹è¯•é¡µé¢**: http://8.148.70.18:9000/comprehensive-test
- **APIæ–‡æ¡£**: http://8.148.70.18:9000/
- **é¡¹ç›®æ–‡ä»¶**: /home/CapCutAPI/
- **ç¤ºä¾‹ä»£ç **: /home/CapCutAPI/example.py

---

ç°åœ¨æ‚¨å·²ç»æ‹¥æœ‰äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„CapCutAPIæœåŠ¡ï¼å¼€å§‹åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªè‡ªåŠ¨åŒ–è§†é¢‘é¡¹ç›®å§ï¼ğŸš€ 