# CapCutAPI 完整使用指南

## 📋 项目概述

CapCutAPI是一个基于Python Flask的剪映/CapCut自动化API服务，可以通过HTTP API接口实现视频编辑的自动化操作。

### 🌐 当前部署状态
- **✅ 服务状态**: 正在运行
- **🌍 访问地址**: http://8.148.70.18:9000
- **🐍 Python版本**: 3.9.7
- **📍 部署位置**: /home/CapCutAPI

## 🚀 快速开始

### 方法1: 网页界面测试（推荐新手）
**立即体验:** http://8.148.70.18:9000/comprehensive-test

1. 打开测试页面
2. 点击"运行所有测试"按钮
3. 观察测试结果和API响应
4. 根据结果了解API功能

### 方法2: 命令行测试
```bash
# 测试1: 获取API信息
curl http://8.148.70.18:9000/

# 测试2: 创建草稿
curl -X POST http://8.148.70.18:9000/create_draft \
  -H "Content-Type: application/json" \
  -d '{"draft_name":"我的第一个草稿"}'
```

### 方法3: Python脚本
运行项目提供的测试脚本：
```bash
cd /home/CapCutAPI
python3.9 test_api.py
```

## 🎬 核心功能详解

### 1. 📝 创建视频草稿
```bash
# 基础创建
curl -X POST http://8.148.70.18:9000/create_draft \
  -H "Content-Type: application/json" \
  -d '{
    "draft_name": "我的视频项目",
    "width": 1080,
    "height": 1920
  }'
```

**支持的视频尺寸:**
- 竖屏: 1080x1920 (抖音、快手)
- 横屏: 1920x1080 (YouTube、B站)
- 方形: 1080x1080 (Instagram)

### 2. ✏️ 添加文本内容
```bash
curl -X POST http://8.148.70.18:9000/add_text \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "text": "欢迎关注我的频道！",
    "start": 0,
    "end": 3,
    "font": "HarmonyOS_Sans_SC_Bold",
    "font_color": "#FF0000",
    "font_size": 36.0,
    "track_name": "title_text"
  }'
```

### 3. 🖼️ 添加图片素材
```bash
curl -X POST http://8.148.70.18:9000/add_image \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "image_url": "https://example.com/image.jpg",
    "start": 0,
    "end": 5,
    "track_name": "background_image"
  }'
```

### 4. 🎵 添加背景音乐
```bash
curl -X POST http://8.148.70.18:9000/add_audio \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "audio_url": "https://example.com/music.mp3",
    "start": 0,
    "end": 30,
    "target_start": 0,
    "volume": 0.8,
    "track_name": "background_music"
  }'
```

### 5. 🎥 添加视频片段
```bash
curl -X POST http://8.148.70.18:9000/add_video \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "video_url": "https://example.com/video.mp4",
    "start": 0,
    "end": 10,
    "width": 1080,
    "height": 1920,
    "track_name": "main_video"
  }'
```

### 6. 💾 保存草稿
```bash
curl -X POST http://8.148.70.18:9000/save_draft \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "draft_folder": "/tmp/my_capcut_project"
  }'
```

## 📱 实际应用场景

### 场景1: 自动化短视频制作
```python
import requests
import json

BASE_URL = "http://8.148.70.18:9000"

def create_short_video():
    # 1. 创建竖屏草稿
    draft_response = requests.post(f"{BASE_URL}/create_draft", json={
        "draft_name": "每日短视频",
        "width": 1080,
        "height": 1920
    })
    draft_id = draft_response.json()["output"]["draft_id"]
    
    # 2. 添加标题文字
    requests.post(f"{BASE_URL}/add_text", json={
        "draft_id": draft_id,
        "text": "今日热点新闻",
        "start": 0,
        "end": 2,
        "font": "HarmonyOS_Sans_SC_Bold",
        "font_color": "#FFFFFF",
        "font_size": 42.0
    })
    
    # 3. 添加背景图片
    requests.post(f"{BASE_URL}/add_image", json={
        "draft_id": draft_id,
        "image_url": "https://picsum.photos/1080/1920",
        "start": 0,
        "end": 15
    })
    
    # 4. 添加内容文字
    requests.post(f"{BASE_URL}/add_text", json={
        "draft_id": draft_id,
        "text": "这里是新闻内容...",
        "start": 2,
        "end": 12,
        "font": "HarmonyOS_Sans_SC_Regular",
        "font_color": "#000000",
        "font_size": 28.0
    })
    
    # 5. 保存草稿
    requests.post(f"{BASE_URL}/save_draft", json={
        "draft_id": draft_id,
        "draft_folder": "/tmp/daily_shorts"
    })
    
    return draft_id

# 执行函数
video_id = create_short_video()
print(f"短视频草稿创建完成: {video_id}")
```

### 场景2: 批量处理多个视频
```python
def batch_create_videos(video_data_list):
    """批量创建多个视频草稿"""
    results = []
    
    for video_data in video_data_list:
        # 创建草稿
        draft_response = requests.post(f"{BASE_URL}/create_draft", json={
            "draft_name": video_data["title"],
            "width": 1920,
            "height": 1080
        })
        draft_id = draft_response.json()["output"]["draft_id"]
        
        # 添加视频内容
        requests.post(f"{BASE_URL}/add_video", json={
            "draft_id": draft_id,
            "video_url": video_data["video_url"],
            "start": 0,
            "end": video_data["duration"]
        })
        
        # 添加字幕
        requests.post(f"{BASE_URL}/add_text", json={
            "draft_id": draft_id,
            "text": video_data["subtitle"],
            "start": 0,
            "end": video_data["duration"],
            "font": "HarmonyOS_Sans_SC_Regular",
            "font_size": 24.0
        })
        
        results.append(draft_id)
    
    return results

# 示例数据
videos = [
    {"title": "视频1", "video_url": "http://example.com/v1.mp4", "duration": 30, "subtitle": "第一段内容"},
    {"title": "视频2", "video_url": "http://example.com/v2.mp4", "duration": 45, "subtitle": "第二段内容"},
]

batch_results = batch_create_videos(videos)
```

### 场景3: 动态内容生成
```python
def create_dynamic_content(news_data):
    """根据新闻数据动态生成视频"""
    
    # 创建草稿
    draft_response = requests.post(f"{BASE_URL}/create_draft", json={
        "draft_name": f"新闻_{news_data['date']}",
        "width": 1080,
        "height": 1920
    })
    draft_id = draft_response.json()["output"]["draft_id"]
    
    # 动态添加新闻标题
    requests.post(f"{BASE_URL}/add_text", json={
        "draft_id": draft_id,
        "text": news_data["headline"],
        "start": 0,
        "end": 3,
        "font": "HarmonyOS_Sans_SC_Bold",
        "font_color": "#FF4444",
        "font_size": 38.0
    })
    
    # 分段添加新闻内容
    content_parts = news_data["content"].split("。")
    for i, part in enumerate(content_parts[:5]):  # 最多5段
        if part.strip():
            requests.post(f"{BASE_URL}/add_text", json={
                "draft_id": draft_id,
                "text": part.strip() + "。",
                "start": 3 + i * 2,
                "end": 5 + i * 2,
                "font": "HarmonyOS_Sans_SC_Regular",
                "font_size": 26.0
            })
    
    return draft_id
```

## 🛠️ 高级功能

### 获取可用资源
```bash
# 获取所有可用字体
curl http://8.148.70.18:9000/get_font_types

# 获取转场效果类型
curl http://8.148.70.18:9000/get_transition_types

# 获取蒙版类型
curl http://8.148.70.18:9000/get_mask_types
```

### 添加特效和动画
```bash
# 添加文本入场动画
curl -X POST http://8.148.70.18:9000/add_effect \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "track_name": "your_text_track",
    "effect_type": "intro_animation",
    "effect_name": "fade_in"
  }'
```

### 添加贴纸和装饰
```bash
curl -X POST http://8.148.70.18:9000/add_sticker \
  -H "Content-Type: application/json" \
  -d '{
    "draft_id": "your_draft_id",
    "sticker_url": "https://example.com/sticker.png",
    "start": 0,
    "end": 5,
    "x": 100,
    "y": 100
  }'
```

## 📊 监控和管理

### 检查服务状态
```bash
# 查看API服务状态
curl http://8.148.70.18:9000/

# 检查服务器进程
ps aux | grep capcut_server

# 查看服务器日志
tail -f /home/CapCutAPI/capcut_server.log
```

### 重启服务
```bash
cd /home/CapCutAPI

# 停止服务
pkill -f "python3.9 capcut_server.py"

# 重新启动
nohup python3.9 capcut_server.py > capcut_server.log 2>&1 &
```

## 📝 最佳实践

### 1. 错误处理
```python
def safe_api_call(endpoint, data):
    try:
        response = requests.post(f"{BASE_URL}/{endpoint}", json=data, timeout=30)
        response.raise_for_status()
        return response.json()
    except requests.exceptions.RequestException as e:
        print(f"API调用失败: {e}")
        return None
```

### 2. 草稿ID管理
```python
class CapCutProject:
    def __init__(self, name):
        self.name = name
        self.draft_id = None
        
    def create_draft(self, width=1080, height=1920):
        response = requests.post(f"{BASE_URL}/create_draft", json={
            "draft_name": self.name,
            "width": width,
            "height": height
        })
        self.draft_id = response.json()["output"]["draft_id"]
        return self.draft_id
    
    def add_text(self, text, start, end, **kwargs):
        if not self.draft_id:
            raise ValueError("请先创建草稿")
        
        data = {
            "draft_id": self.draft_id,
            "text": text,
            "start": start,
            "end": end,
            **kwargs
        }
        return requests.post(f"{BASE_URL}/add_text", json=data)
```

### 3. 时间轴管理
```python
class Timeline:
    def __init__(self):
        self.events = []
    
    def add_event(self, event_type, start, end, data):
        self.events.append({
            "type": event_type,
            "start": start,
            "end": end,
            "data": data
        })
    
    def get_duration(self):
        if not self.events:
            return 0
        return max(event["end"] for event in self.events)
    
    def execute(self, draft_id):
        for event in self.events:
            if event["type"] == "text":
                requests.post(f"{BASE_URL}/add_text", json={
                    "draft_id": draft_id,
                    **event["data"],
                    "start": event["start"],
                    "end": event["end"]
                })
```

## 🔧 故障排除

### 常见问题

**Q: API返回404错误？**
A: 检查端点路径是否正确，确保使用POST方法访问需要POST的端点

**Q: 字体不支持错误？**
A: 使用 `curl http://8.148.70.18:9000/get_font_types` 查看支持的字体列表

**Q: 草稿保存失败？**
A: 检查保存路径权限，建议使用 `/tmp/` 目录

**Q: 服务器无响应？**
A: 检查服务器状态：`ps aux | grep capcut_server`

### 调试技巧
```bash
# 查看详细错误日志
tail -f /home/CapCutAPI/capcut_server.log

# 测试网络连通性
curl -I http://8.148.70.18:9000/

# 验证JSON格式
echo '{"test": "data"}' | python3.9 -m json.tool
```

## 🎯 下一步

1. **熟悉基础功能**: 使用网页测试界面了解API功能
2. **编写自动化脚本**: 根据您的需求编写Python脚本
3. **集成到现有系统**: 将API集成到您的工作流程中
4. **扩展功能**: 根据需要添加新的API端点

## 📞 获取帮助

- **测试页面**: http://8.148.70.18:9000/comprehensive-test
- **API文档**: http://8.148.70.18:9000/
- **项目文件**: /home/CapCutAPI/
- **示例代码**: /home/CapCutAPI/example.py

---

现在您已经拥有了一个功能完整的CapCutAPI服务！开始创建您的第一个自动化视频项目吧！🚀 