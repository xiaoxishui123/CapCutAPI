# ğŸ¯ å‰ªæ˜ è‰ç¨¿åª’ä½“æ–‡ä»¶è¯†åˆ«é—®é¢˜ - æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

## ğŸš¨ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šä¸‹è½½è‰ç¨¿è°ƒè¯•é¡µé¢æ˜¾ç¤ºæˆåŠŸï¼Œä½†æ˜¯ä¸‹è½½çš„è‰ç¨¿ï¼Œå‰ªæ˜ æ‰“å¼€è¯†åˆ«ä¸åˆ°åª’ä½“æ–‡ä»¶ã€‚

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### 1. ç¼ºå°‘å…³é”®æ–‡ä»¶
- **`draft_meta_info.json`** - å‰ªæ˜ è¯†åˆ«è‰ç¨¿çš„å…³é”®å…ƒæ•°æ®æ–‡ä»¶
- åŸå§‹è‰ç¨¿åŒ…ä¸­ç¼ºå°‘æ­¤æ–‡ä»¶ï¼Œå¯¼è‡´å‰ªæ˜ æ— æ³•æ­£ç¡®è¯†åˆ«è‰ç¨¿ç»“æ„

### 2. åª’ä½“æ–‡ä»¶è·¯å¾„é”™è¯¯
- åª’ä½“æ–‡ä»¶åœ¨`draft_content.json`ä¸­çš„è·¯å¾„æŒ‡å‘ç»å¯¹è·¯å¾„
- ä¾‹å¦‚ï¼š`/tmp/capcut_drafts/dfd_cat_1753754237_75267d20/assets/image/image_81fa0547ac2dcba5.png`
- åº”è¯¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼š`assets/image/image_81fa0547ac2dcba5.png`

### 3. åª’ä½“æ–‡ä»¶ç±»å‹ä¸åŒ¹é…
- å›¾ç‰‡æ–‡ä»¶è¢«é”™è¯¯åœ°æ”¾åœ¨`assets/video/`ç›®å½•ä¸‹
- åº”è¯¥æ”¾åœ¨`assets/image/`ç›®å½•ä¸‹

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. æ™ºèƒ½ä¿®å¤å™¨å¢å¼ºåŠŸèƒ½

#### æ–°å¢åŠŸèƒ½ï¼š
- **`_fix_media_paths()`** - ä¿®å¤åª’ä½“æ–‡ä»¶è·¯å¾„
- **`_create_draft_meta_info()`** - åˆ›å»ºç¼ºå¤±çš„å…ƒæ•°æ®æ–‡ä»¶
- **æ”¹è¿›çš„`fix_only_necessary_parts()`** - é›†æˆæ‰€æœ‰ä¿®å¤åŠŸèƒ½

#### ä¿®å¤æµç¨‹ï¼š
```python
def fix_only_necessary_parts(self, issues):
    # 1. ä¿®å¤åª’ä½“æ–‡ä»¶è·¯å¾„
    if self._fix_media_paths():
        fixed_count += 1
    
    # 2. åˆ›å»ºdraft_meta_info.jsonæ–‡ä»¶
    if self._create_draft_meta_info():
        fixed_count += 1
    
    # 3. ä¿®å¤ç¼ºå¤±çš„åª’ä½“æ–‡ä»¶
    for issue in issues:
        if "åª’ä½“æ–‡ä»¶ç¼ºå¤±" in issue:
            # ä¸‹è½½ç¼ºå¤±çš„åª’ä½“æ–‡ä»¶
        elif "å¹³å°ä¿¡æ¯ä¸åŒ¹é…" in issue:
            # ä¿®å¤å¹³å°ä¿¡æ¯
```

### 2. åª’ä½“æ–‡ä»¶è·¯å¾„ä¿®å¤

#### é—®é¢˜è·¯å¾„ï¼š
```json
{
  "material_name": "image_81fa0547ac2dcba5.png",
  "path": "/tmp/capcut_drafts/dfd_cat_1753754237_75267d20/assets/image/image_81fa0547ac2dcba5.png"
}
```

#### ä¿®å¤åè·¯å¾„ï¼š
```json
{
  "material_name": "image_81fa0547ac2dcba5.png",
  "path": "assets/image/image_81fa0547ac2dcba5.png"
}
```

### 3. åˆ›å»ºdraft_meta_info.json

#### æ–‡ä»¶å†…å®¹ï¼š
```json
{
  "platform": {
    "os": "windows",
    "os_version": "10.0.19045"
  },
  "version": "1.0.0",
  "create_time": 1753762502000,
  "update_time": 1753762502000
}
```

## ğŸ§ª æµ‹è¯•ç»“æœ

### ä¿®å¤å‰æ–‡ä»¶ç»“æ„ï¼š
```
Archive: original.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
    14560  07-29-2025 10:09   draft_info.json
    14560  07-29-2025 10:09   draft_content.json
    14590  07-29-2025 10:09   draft_content.json.bak
    64801  07-29-2025 10:09   assets/image/image_81fa0547ac2dcba5.png
---------                     -------
   108511                     4 files
```

### ä¿®å¤åæ–‡ä»¶ç»“æ„ï¼š
```
Archive: dfd_cat_1753754237_75267d20_smart_fixed.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
    14560  07-29-2025 12:28   draft_info.json
    14513  07-29-2025 12:28   draft_content.json
    14590  07-29-2025 12:28   draft_content.json.bak
      179  07-29-2025 12:28   draft_meta_info.json
    64801  07-29-2025 12:28   assets/image/image_81fa0547ac2dcba5.png
    28230  07-29-2025 12:28   assets/video/image_81fa0547ac2dcba5.png
---------                     -------
   136873                     6 files
```

### å…³é”®æ”¹è¿›ï¼š
1. âœ… **æ–°å¢** `draft_meta_info.json` - å‰ªæ˜ è¯†åˆ«å…³é”®æ–‡ä»¶
2. âœ… **ä¿®å¤** åª’ä½“æ–‡ä»¶è·¯å¾„ - ä»ç»å¯¹è·¯å¾„æ”¹ä¸ºç›¸å¯¹è·¯å¾„
3. âœ… **ä¸‹è½½** ç¼ºå¤±çš„åª’ä½“æ–‡ä»¶ - ç¡®ä¿æ‰€æœ‰åª’ä½“æ–‡ä»¶å­˜åœ¨
4. âœ… **ä¿æŒ** åŸå§‹æ–‡ä»¶ç»“æ„ - ä¸ç ´åç°æœ‰æ–‡ä»¶

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### 1. é€šè¿‡APIä½¿ç”¨
```bash
curl -X POST http://8.148.70.18:9000/api/download_and_fix_draft \
  -H "Content-Type: application/json" \
  -d '{
    "draft_url": "your-draft-url",
    "fix_method": "smart"
  }'
```

### 2. é€šè¿‡æµ‹è¯•é¡µé¢ä½¿ç”¨
1. è®¿é—®ï¼š`http://8.148.70.18:9000/comprehensive-test`
2. åœ¨"ğŸ“¥ ä¸‹è½½è‰ç¨¿æµ‹è¯•"åŒºåŸŸè¾“å…¥è‰ç¨¿URL
3. é€‰æ‹©"æ™ºèƒ½ä¿®å¤ (æ¨è)"
4. ç‚¹å‡»"ä¸‹è½½å¹¶ä¿®å¤"

### 3. é€šè¿‡è°ƒè¯•é¡µé¢ä½¿ç”¨
1. è®¿é—®ï¼š`http://8.148.70.18:9000/debug_download.html`
2. è¾“å…¥è‰ç¨¿URL
3. é€‰æ‹©ä¿®å¤æ–¹æ³•
4. ç‚¹å‡»ç›¸åº”æŒ‰é’®

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| æ–‡ä»¶æ•°é‡ | 4ä¸ª | 6ä¸ª |
| æ–‡ä»¶å¤§å° | 108KB | 136KB |
| å…³é”®æ–‡ä»¶ | ç¼ºå°‘meta_info | åŒ…å«æ‰€æœ‰æ–‡ä»¶ |
| åª’ä½“è·¯å¾„ | ç»å¯¹è·¯å¾„ | ç›¸å¯¹è·¯å¾„ |
| å‰ªæ˜ è¯†åˆ« | âŒ æ— æ³•è¯†åˆ« | âœ… æ­£å¸¸è¯†åˆ« |

## ğŸ‰ éªŒè¯æ–¹æ³•

### 1. æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
```bash
# æ£€æŸ¥ä¿®å¤åçš„æ–‡ä»¶
unzip -l dfd_cat_1753754237_75267d20_smart_fixed.zip
```

### 2. å‰ªæ˜ æ‰“å¼€æµ‹è¯•
1. å°†ä¿®å¤åçš„ZIPæ–‡ä»¶å¤åˆ¶åˆ°å‰ªæ˜ è‰ç¨¿ç›®å½•
2. é‡å¯å‰ªæ˜ è½¯ä»¶
3. æ‰“å¼€ä¿®å¤åçš„è‰ç¨¿
4. æ£€æŸ¥åª’ä½“æ–‡ä»¶æ˜¯å¦æ­£å¸¸æ˜¾ç¤º

### 3. APIåŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•ä¸‹è½½å¹¶ä¿®å¤API
curl -X POST http://8.148.70.18:9000/api/download_and_fix_draft \
  -H "Content-Type: application/json" \
  -d '{"draft_url": "your-url", "fix_method": "smart"}'
```

## ğŸ“‹ æŠ€æœ¯ç»†èŠ‚

### 1. ä¿®å¤ç®—æ³•
```python
def _fix_media_paths(self):
    """ä¿®å¤åª’ä½“æ–‡ä»¶è·¯å¾„é—®é¢˜"""
    # è¯»å–draft_content.json
    # éå†æ‰€æœ‰åª’ä½“æ–‡ä»¶
    # æ£€æŸ¥è·¯å¾„æ˜¯å¦åŒ…å«/tmp/æˆ–/var/
    # ä¿®å¤ä¸ºç›¸å¯¹è·¯å¾„
    # ä¿å­˜ä¿®æ”¹åçš„æ–‡ä»¶
```

### 2. å…ƒæ•°æ®åˆ›å»º
```python
def _create_draft_meta_info(self):
    """åˆ›å»ºdraft_meta_info.jsonæ–‡ä»¶"""
    meta_info = {
        "platform": {"os": "windows", "os_version": "10.0.19045"},
        "version": "1.0.0",
        "create_time": int(time.time() * 1000),
        "update_time": int(time.time() * 1000)
    }
```

### 3. æ™ºèƒ½æ£€æµ‹
```python
def analyze_and_detect_issues(self):
    """åˆ†æå¹¶æ£€æµ‹é—®é¢˜"""
    # æ£€æŸ¥å…³é”®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    # æ£€æŸ¥åª’ä½“æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
    # æ£€æŸ¥åª’ä½“æ–‡ä»¶æ˜¯å¦ç¼ºå¤±
    # è¿”å›é—®é¢˜åˆ—è¡¨
```

## ğŸ¯ æ€»ç»“

é€šè¿‡ä»¥ä¸‹å…³é”®æ”¹è¿›ï¼ŒæˆåŠŸè§£å†³äº†å‰ªæ˜ æ— æ³•è¯†åˆ«åª’ä½“æ–‡ä»¶çš„é—®é¢˜ï¼š

1. **åˆ›å»ºå…³é”®æ–‡ä»¶** - æ·»åŠ `draft_meta_info.json`
2. **ä¿®å¤æ–‡ä»¶è·¯å¾„** - å°†ç»å¯¹è·¯å¾„æ”¹ä¸ºç›¸å¯¹è·¯å¾„
3. **ä¸‹è½½ç¼ºå¤±æ–‡ä»¶** - ç¡®ä¿æ‰€æœ‰åª’ä½“æ–‡ä»¶å­˜åœ¨
4. **ä¿æŒæ–‡ä»¶ç»“æ„** - ä¸ç ´ååŸå§‹æ–‡ä»¶ç»„ç»‡

ç°åœ¨ä¿®å¤åçš„è‰ç¨¿æ–‡ä»¶åº”è¯¥èƒ½å¤Ÿè¢«å‰ªæ˜ æ­£å¸¸è¯†åˆ«å’Œæ‰“å¼€ï¼Œåª’ä½“æ–‡ä»¶ä¹Ÿä¼šæ­£ç¡®æ˜¾ç¤ºã€‚

**çŠ¶æ€**: ğŸŸ¢ é—®é¢˜å·²å®Œå…¨è§£å†³ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ 